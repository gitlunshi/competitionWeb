<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/static/css/element-ui.css"/>
    <link rel="stylesheet" href="/static/css/index.css"/>
    <script src="/static/js/jquery-3.7.1.min.js"></script>
    <script src="/static/js/vue.js"></script>
    <script src="/static/js/index.js"></script>

</head>
<body>
<img src="/static/img/hh.png">
<div id="app">
    <el-upload
            class="upload-demo"
            ref="upload"
            name="data"
            action="/common/uploadResources"
            :on-preview="handlePreview"
            :before-upload="beforeAvatarUpload"
            :on-remove="handleRemove"
            :on-success="subSuccess"
            :on-error="subError"
            :file-list="fileList"
            :limit="1"
            :auto-upload="false">
        <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
        <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器</el-button>
        <div slot="tip" class="el-upload__tip">只能上传txt文件，且不超过10MB，文件名格式为“学号+姓名”，文件内容写入侵过程，越详细越好！！</div>
    </el-upload>
</div>
</body>
<script src="/static/js/element-ui.js"></script>
<script>

    var app;
    $(document).ready(function () {
        app = new Vue({
            el: '#app',
            data: {
                fileList: []
            },
            methods: {
                submitUpload() {
                    this.$refs.upload.submit();
                },
                handleRemove(file, fileList) {
                    console.log(file, fileList);
                },
                handlePreview(file) {
                    console.log(file);
                },
                beforeAvatarUpload(file) {
                    const isJPG = file.type === 'text/plain';
                    const isLt2M = file.size / 1024/1024 < 10;
                    console.log(file.type)
                    if (!isJPG) {
                        this.fileList=[];
                        this.$message.error('上传的文件必须是txt格式!');
                        return false;
                    }
                    if (!isLt2M) {
                        this.fileList=[];
                        this.$message.error('上传文件大小不能超过10MB!');
                        return false;
                    }
                    return isJPG && isLt2M;
                },
                subSuccess(response, file, fileList){
                    if (response.code!=200){
                        app.$message.error(response.msg);
                    }else{
                        app.$message.success("上传成功");
                    }
                    this.fileList=[];
                },
                subError(err, file, fileList){

                },
            }
        });
    });
</script>

</html>